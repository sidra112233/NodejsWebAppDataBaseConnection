<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercises</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism.min.css" />
    <style>
        body, html {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
            background: white;
            color: #333;
        }

        .container {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 96%;
            max-width: 900px;
            margin: 0 auto;
            background: linear-gradient(135deg, #e1f5fe, #b3e5fc);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: auto-y;
        }

        .header {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #b3e5fc;
            padding: 10px;
            border-bottom: 2px solid #81d4fa;
            position: relative;
        }

        .header h1 {
            margin: 0;
            font-size: 25px;
            color: #01579b;
        }

        .back-button {
            position: absolute;
            left: 15px;
            top: 10px;
            background: #0056b3;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #ffffff;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease;
        }

        .back-button:hover {
            background: #003d80;
        }

        .question-section {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            color: #003366;
        }

        .question-section h2 {
            margin: 0;
            font-size: 35px;
            text-align: center;
            border-bottom: 1px solid #81d4fa;
            padding-bottom: 10px;
            margin-bottom: 10px;
            color: #e1f5fe;
        }

        .question {
            font-size: 16px;
            margin-bottom: 10px;
        }

        .code-area {
            padding: 10px;
            background: linear-gradient(135deg, #e1f5fe, #f1f8e9, #bbdefb);
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
            font-family: monospace;
            overflow-x: auto;
            color: #333;
        }

        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #ddd;
        }

        code {
            display: block;
            padding: 10px;
            background: transparent;
            border: none;
            white-space: pre-wrap;
            color: #333;
        }

        .code-input {
            width: 100px;
            height: 24px;
            margin: 5px;
            padding: 2px;
            border: 1px solid #b3b3b3;
            border-radius: 4px;
            font-family: Arial, sans-serif;
            display: inline-block;
            text-align: center;
            box-sizing: border-box;
        }

        .actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        .actions button {
            background: #4db8ff;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .actions button:hover {
            background: #3399ff;
        }

        .feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }

        .correct {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .incorrect {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="back-button" onclick="window.history.back()">&#8592;</button>
            <h1>Guess the Correct Words</h1>
        </div>
        <div class="question-section">
            <% exercises.forEach((exercise, index) => { %>
                <h2><%= exercise.title %></h2>
                <p class="question"><%= exercise.question_text %></p>
                <div class="code-area">
                    <pre><code>
                        <% 
                            let parts = exercise.code_snippet.split(/(<input\d+>)/g);
                            let inputIndex = 0;
                            parts.forEach(part => {
                                if (part.match(/<input\d+>/)) {
                                    inputIndex++;
                                    let label = `Input ${inputIndex}`;
                                    %><input type="text" id="input-<%= index %>-<%= inputIndex %>" class="code-input" placeholder="<%= label %>" /><% 
                                } else {
                                    %><%= part %><% 
                                }
                            });
                        %>
                    </code></pre>
                </div>
                <div class="actions">
                    <button onclick="showAnswer(<%= index %>, '<%= exercise.correct_answers %>')">Show Answer</button>
                    <button onclick="submitAnswer(<%= index %>, '<%= exercise.correct_answers %>')">Submit</button>
                </div>
                <div class="feedback" id="feedback-<%= index %>"></div>
            <% }) %>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-java.min.js"></script>
    <script>
        function showAnswer(index, correctAnswer) {
            const feedbackDiv = document.getElementById(`feedback-${index}`);
            feedbackDiv.textContent = `The correct code is: ${correctAnswer}`;
            feedbackDiv.className = 'feedback correct';
            feedbackDiv.style.display = 'block';
        }

        function submitAnswer(index, correctAnswer) {
            const inputs = document.querySelectorAll(`#input-${index}-1, #input-${index}-2, #input-${index}-3, #input-${index}-4`);
            let userAnswers = [];

            inputs.forEach(input => {
                userAnswers.push(input.value.trim());
            });

            console.log('User Answers:', userAnswers);
            console.log('Correct Answer:', correctAnswer);

            const correctAnswerObject = JSON.parse(correctAnswer);
            const correctAnswers = Object.values(correctAnswerObject);

            console.log('Normalized Correct Answers:', correctAnswers);

            const feedbackDiv = document.getElementById(`feedback-${index}`);
            const isCorrect = userAnswers.every((userAnswer, idx) => {
                return correctAnswers[idx] && userAnswer.includes(correctAnswers[idx]);
            });

            if (isCorrect) {
                feedbackDiv.textContent = 'Correct! Well done.';
                feedbackDiv.className = 'feedback correct';
            } else {
                feedbackDiv.textContent = 'Incorrect, try again.';
                feedbackDiv.className = 'feedback incorrect';
            }
            feedbackDiv.style.display = 'block';
        }
    </script>
</body>
</html>