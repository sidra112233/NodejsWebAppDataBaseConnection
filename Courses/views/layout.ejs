<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
    <title>Course Management</title>
<style>
    
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    color: #2E073F;
    display: flex;
    flex-direction: column;
    height: 100vh;
}

.navbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(135deg, #A8DADC, #F1FAEE); /* Soft teal to very light mint gradient */
    padding: 10px 20px;
}

.navbar-left {
    display: flex;
    align-items: center;
}

.logo {
    height: 40px;
    margin-right: 10px;
}

.site-name {
    color: #1D3557; /* Deep blue text color */
    font-size: 1.5em;
}

.navbar-right a {
    color: #1D3557; /* Deep blue text color */
    padding: 14px 20px;
    text-decoration: none;
    text-align: center;
}

.navbar-right a:hover {
    background-color: #A8DADC; /* Light teal on hover */
}

@media screen and (max-width: 500px) {
    .navbar a {
        float: none;
        display: block;
    }
}

.register-btn {
    border: 1px solid #1D3557; /* Deep blue border */
    border-radius: 5px;
}

/* Main container for sidebar and content */
.main-container {
    display: flex;
    flex: 1;
    overflow: hidden;
    height: calc(100vh - 60px); /* Adjust height based on navbar height */
}

/* Sidebar styling */
#sidebar {
    width: 250px;
    background: linear-gradient(135deg, #F4A261, #FFE8D6); /* Soft orange to light peach gradient */
    color: #1D3557; /* Deep blue text color */
    padding: 15px;
    overflow-y: auto;
    height: 100%;
}
.logo1 {
    height: 150px;
    width: 200px;

margin-top:0;
}

/* Content styling */
#content {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    height: 100%;
    background: linear-gradient(135deg, #F1FAEE, #A8DADC); /* Very light mint to soft teal gradient */
}
.module-description {
    color: #4A4E69; /* Soft dark blue color */
    font-style: italic;
    font-size: 1.1em;
    background-color: #F2E9E4; /* Light beige background */
    padding: 10px;
    border-left: 4px solid #9A8C98; /* Accent color on the left */
    border-radius: 5px;
    margin-bottom: 10px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Soft shadow for a slight 3D effect */
    transition: background-color 0.3s ease, color 0.3s ease;
}

.module-description:hover {
    background-color: #E8D6CF; /* Slightly darker beige on hover */
    color: #333; /* Darker text on hover */
}

#course-list, .module-list ul, #material-list {
    list-style-type: none;
    padding: 0;
    margin: 0;
}
#quiz-list a {
    text-decoration: none;
    color: #FF6F61; /* A beautiful coral color */
    display: block;
    padding: 10px;
    background-color: #FFE5D4; /* Soft peach background */
    border-radius: 5px;
    margin-bottom: 50px;
    transition: background-color 0.3s ease, color 0.3s ease;
    width: 200px;
}

#quiz-list a:hover {
    background-color: #FF6F61; /* Coral background on hover */
    color: white; /* White text on hover */
    text-decoration: none;
}


#course-list li, .module-list ul li {
    margin-bottom: 10px;
}

#course-list a, .module-list a, .material-link {
    text-decoration: none;
    color: #1D3557; /* Deep blue text color */
    display: block;
    padding: 5px;
    margin-bottom: 20px;
}

.module-list {
    display: none;
    padding-left: 20px;
}

.module-list a:hover, #course-list a:hover, .material-link:hover {
    text-decoration: underline;
}

.material-description {
    color: #457B9D; /* Soft blue for material description */
    font-style: italic;
    margin-bottom: 5px;
}

.loading {
    font-style: italic;
    color: #555;
}

    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
    <div class="navbar-left">
        <img src="/images/Logo.png" alt="Logo" class="logo">
        <span class="site-name">LEARN CODE PRO</span>
    </div>
    <div class="navbar-right">
        <a href="/">Home</a>
        <a href="/about">About</a>
        <a href="/contact">Contact</a>
        <a href="/sign-up" class="register-btn">Sign Up</a>
    </div>
</nav>

<!-- Main container for sidebar and content -->
<div class="main-container">
    <div id="sidebar">
    <img src="/images/Logo.png" alt="Logo" class="logo1">
        <h2>Courses</h2>
        <ul id="course-list">
            <% if (courses && courses.length > 0) { %>
                <% courses.forEach(course => { %>
                    <li>
                        <a href="#" class="course-link" data-course-id="<%= course.course_id %>"><%= course.course_name %></a>
                        <div class="module-list" data-course-id="<%= course.course_id %>">
                            <h3>Modules</h3>
                            <ul class="module-items"></ul>
                        </div>
                    </li>
                <% }); %>
            <% } else { %>
                <li>No courses available</li>
            <% } %>
        </ul>
    </div>
    <div id="content">
        <h2 id="course-name"><%= courseName || 'Select a Course' %></h2>
        <p id="course-description"><%= courseDescription || 'Course description will appear here.' %></p>
        <div id="module-name"></div>
        <div id="module-description"></div>
        <ul id="material-list"></ul>
        <ul id="quiz-list"></ul>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const courseList = document.getElementById('course-list');
            const courseNameElement = document.getElementById('course-name');
            const courseDescriptionElement = document.getElementById('course-description');
            const moduleNameElement = document.getElementById('module-name');
            const moduleDescriptionElement = document.getElementById('module-description');
            const materialList = document.getElementById('material-list');
            const quizList = document.getElementById('quiz-list');
            const sidebar = document.getElementById('sidebar');

            courseList.addEventListener('click', async (event) => {
                if (event.target && event.target.classList.contains('course-link')) {
                    event.preventDefault();
                    const courseId = event.target.dataset.courseId;

                    // Hide all module lists and remove module list content from other courses
                    document.querySelectorAll('.module-list').forEach(moduleList => {
                        if (moduleList.dataset.courseId !== courseId) {
                            moduleList.style.display = 'none';
                        }
                    });

                    const selectedModuleList = document.querySelector(`.module-list[data-course-id="${courseId}"]`);

                    try {
                        // Show loading message
                        courseNameElement.textContent = 'Loading...';
                        courseDescriptionElement.textContent = '';

                        // Fetch modules for the selected course
                        const response = await fetch(`/courses/${courseId}/modules`);
                        const data = await response.json();

                        // Update course content
                        courseNameElement.textContent = data.courseName || 'Course Name';
                        courseDescriptionElement.textContent = data.courseDescription || 'Course Description';

                        // Show or update the module list for the selected course
                        if (selectedModuleList) {
                            selectedModuleList.style.display = 'block';
                            const moduleItemsElement = selectedModuleList.querySelector('.module-items');
                            moduleItemsElement.innerHTML = '';
                            data.modules.forEach(module => {
                                moduleItemsElement.innerHTML += `<li><a href="#" class="module-link" data-module-id="${module.module_id}">${module.module_name}</a></li>`;
                            });
                        }

                        // Clear materials and quizzes
                        materialList.innerHTML = '';
                        quizList.innerHTML = '';
                        moduleNameElement.textContent = '';
                        moduleDescriptionElement.textContent = '';
                    } catch (error) {
                        console.error('Error fetching course modules:', error);
                        courseNameElement.textContent = 'Error loading course';
                        courseDescriptionElement.textContent = '';
                    }
                }
            });

            sidebar.addEventListener('click', async (event) => {
                if (event.target && event.target.classList.contains('module-link')) {
                    event.preventDefault();
                    const moduleId = event.target.dataset.moduleId;

                    try {
                        // Show loading message
                        moduleNameElement.textContent = 'Loading...';
                        moduleDescriptionElement.textContent = '';

                        // Fetch module details, materials, and quizzes
                        const moduleResponse = await fetch(`/modules/${moduleId}`);
                        const moduleData = await moduleResponse.json();

                        // Update content with module and materials
                        moduleNameElement.textContent = moduleData.module_name || 'Module Name';
                        moduleDescriptionElement.textContent = moduleData.description || 'Module Description';

                        // Update content with materials
                        materialList.innerHTML = '<h3>Materials</h3><ul>';
                        moduleData.materials.forEach(material => {
                            materialList.innerHTML += `
                                <li>
                                    <span class="material-description">${material.description}</span><br>
                                    <a href="#" class="material-link" data-material-id="${material.material_id}">${material.link}</a>
                                </li>`;
                        });
                        materialList.innerHTML += '</ul>';

                        // Update content with quizzes
                        quizList.innerHTML = '<h3>Quizzes</h3><ul>';
                        if (moduleData.quizzes.length === 0) {
                            quizList.innerHTML += '<li>No quizzes available.</li>';
                        } else {
                            moduleData.quizzes.forEach(quiz => {
                                quizList.innerHTML += `<li><a href="/quiz/start/${quiz.quiz_id}">${quiz.quiz_title}</a></li>`;
                            });
                        }
                        quizList.innerHTML += '</ul>';
                    } catch (error) {
                        console.error('Error fetching module details, materials, or quizzes:', error);
                        moduleNameElement.textContent = 'Error loading module';
                        moduleDescriptionElement.textContent = '';
                        materialList.innerHTML = '<li>Error loading materials.</li>';
                        quizList.innerHTML = '<li>Error loading quizzes.</li>';
                    }
                }
            });

            materialList.addEventListener('click', async (event) => {
                if (event.target && event.target.classList.contains('material-link')) {
                    event.preventDefault();
                    const materialId = event.target.dataset.materialId;

                    try {
                        // Fetch material details
                        const response = await fetch(`/materials/${materialId}`);
                        if (response.redirected) {
                            // Redirect to login page if not authenticated
                            window.location.href = response.url;
                        } else {
                            const material = await response.json();
                            // Open material link in a new tab
                            window.open(material.link, '_blank');
                        }
                    } catch (error) {
                        console.error('Error fetching material details:', error);
                    }
                }
            });
        });
    </script>
</body>
</html>

