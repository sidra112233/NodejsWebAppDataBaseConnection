<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Course Management</title>
    <style>
        body {
            display: flex;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
        }
        #sidebar {
            width: 250px;
            background: #f4f4f4;
            padding: 15px;
            overflow-y: auto;
            transition: width 0.3s ease;
            position: relative;
            height: auto;
        }
        #sidebar ul {
            list-style-type: none;
            padding: 0;
        }
        #sidebar ul li {
            margin-bottom: 10px;
        }
        #sidebar ul li a {
            text-decoration: none;
            color: #333;
            display: block;
            padding: 5px;
        }
        .module-list {
            display: none;
            padding-left: 20px;
        }
        .module-list ul {
            list-style-type: none;
            padding: 0;
        }
        .module-list ul li {
            margin-bottom: 5px;
        }
        .module-list ul li a {
            text-decoration: none;
            color: #007bff;
        }
        .module-list ul li a:hover {
            text-decoration: underline;
        }
        #content {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
        }
        .material-description {
            display: block;
            color: #555;
            font-style: italic;
            margin-bottom: 5px;
        }
        .material-link {
            color: #1a73e8;
            text-decoration: none;
        }
        .material-link:hover {
            text-decoration: underline;
        }
        .quiz-list ul {
            list-style-type: none;
            padding: 0;
        }
        .quiz-list ul li {
            margin-bottom: 5px;
        }
        .loading {
            font-style: italic;
            color: #555;
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <h2>Courses</h2>
        <ul id="course-list">
            <% if (courses && courses.length > 0) { %>
                <% courses.forEach(course => { %>
                    <li>
                        <a href="#" class="course-link" data-course-id="<%= course.course_id %>"><%= course.course_name %></a>
                        <div class="module-list" data-course-id="<%= course.course_id %>">
                            <h3>Modules</h3>
                            <ul class="module-items"></ul>
                        </div>
                    </li>
                <% }); %>
            <% } else { %>
                <li>No courses available</li>
            <% } %>
        </ul>
    </div>
    <div id="content">
        <h2 id="course-name"><%= courseName || 'Select a Course' %></h2>
        <p id="course-description"><%= courseDescription || 'Course description will appear here.' %></p>
        <div id="module-name"></div>
        <div id="module-description"></div>
        <ul id="material-list"></ul>
        <ul id="quiz-list"></ul>
    </div>
    <nav>
    <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/dashboard">Dashboard</a></li>
        <!-- Other navigation items -->
    </ul>
</nav>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const courseList = document.getElementById('course-list');
            const courseNameElement = document.getElementById('course-name');
            const courseDescriptionElement = document.getElementById('course-description');
            const moduleNameElement = document.getElementById('module-name');
            const moduleDescriptionElement = document.getElementById('module-description');
            const materialList = document.getElementById('material-list');
            const quizList = document.getElementById('quiz-list');
            const sidebar = document.getElementById('sidebar');

            courseList.addEventListener('click', async (event) => {
                if (event.target && event.target.classList.contains('course-link')) {
                    event.preventDefault();
                    const courseId = event.target.dataset.courseId;

                    // Hide all module lists and remove module list content from other courses
                    document.querySelectorAll('.module-list').forEach(moduleList => {
                        if (moduleList.dataset.courseId !== courseId) {
                            moduleList.style.display = 'none';
                        }
                    });

                    const selectedModuleList = document.querySelector(`.module-list[data-course-id="${courseId}"]`);

                    try {
                        // Show loading message
                        courseNameElement.textContent = 'Loading...';
                        courseDescriptionElement.textContent = '';

                        // Fetch modules for the selected course
                        const response = await fetch(`/courses/${courseId}/modules`);
                        const data = await response.json();

                        // Update course content
                        courseNameElement.textContent = data.courseName || 'Course Name';
                        courseDescriptionElement.textContent = data.courseDescription || 'Course Description';

                        // Show or update the module list for the selected course
                        if (selectedModuleList) {
                            selectedModuleList.style.display = 'block';
                            const moduleItemsElement = selectedModuleList.querySelector('.module-items');
                            moduleItemsElement.innerHTML = '';
                            data.modules.forEach(module => {
                                moduleItemsElement.innerHTML += `<li><a href="#" class="module-link" data-module-id="${module.module_id}">${module.module_name}</a></li>`;
                            });
                        }

                        // Clear materials and quizzes
                        materialList.innerHTML = '';
                        quizList.innerHTML = '';
                        moduleNameElement.textContent = '';
                        moduleDescriptionElement.textContent = '';
                    } catch (error) {
                        console.error('Error fetching course modules:', error);
                        courseNameElement.textContent = 'Error loading course';
                        courseDescriptionElement.textContent = '';
                    }
                }
            });

            sidebar.addEventListener('click', async (event) => {
                if (event.target && event.target.classList.contains('module-link')) {
                    event.preventDefault();
                    const moduleId = event.target.dataset.moduleId;

                    try {
                        // Show loading message
                        moduleNameElement.textContent = 'Loading...';
                        moduleDescriptionElement.textContent = '';

                        // Fetch module details, materials, and quizzes
                        const moduleResponse = await fetch(`/modules/${moduleId}`);
                        const moduleData = await moduleResponse.json();

                        // Update content with module and materials
                        moduleNameElement.textContent = moduleData.module_name || 'Module Name';
                        moduleDescriptionElement.textContent = moduleData.description || 'Module Description';

                        // Update content with materials
                        materialList.innerHTML = '<h3>Materials</h3><ul>';
                        moduleData.materials.forEach(material => {
                            materialList.innerHTML += `
                                <li>
                                    <span class="material-description">${material.description}</span><br>
                                    <a href="${material.link}" class="material-link" target="_blank">${material.link}</a>
                                </li>`;
                        });
                        materialList.innerHTML += '</ul>';

                        // Update content with quizzes
                        quizList.innerHTML = '<h3>Quizzes</h3><ul>';
                        if (moduleData.quizzes.length === 0) {
                            quizList.innerHTML += '<li>No quizzes available.</li>';
                        } else {
                            moduleData.quizzes.forEach(quiz => {
                                quizList.innerHTML += `<li><a href="/quiz/start/${quiz.quiz_id}">${quiz.quiz_title}</a></li>`;
                            });
                        }
                        quizList.innerHTML += '</ul>';
                    } catch (error) {
                        console.error('Error fetching module details, materials, or quizzes:', error);
                        moduleNameElement.textContent = 'Error loading module';
                        moduleDescriptionElement.textContent = '';
                        materialList.innerHTML = '<li>Error loading materials.</li>';
                        quizList.innerHTML = '<li>Error loading quizzes.</li>';
                    }
                }
            });
        });
    </script>
</body>
</html>
